#include "NU32.h"
#define ARRAYSIZE 56

static unsigned int i;
static unsigned int notes[ARRAYSIZE] = {
  0x00100000, 0x00080000, 0x00040000, 0x00020000, 0x00010000,
  0x00008000, 0x00004000, 0x00002000, 0x00001000, 0x00000800,
  0x00000400, 0x00000200, 0x00000100, 0x00000100, 0x00000200,
  0x00000400, 0x00000800, 0x00001000, 0x00002000, 0x00004000,
  0x00008000, 0x00010000, 0x00020000, 0x00040000, 0x00080000,
  0x00100000, 0x00089000, 0x00020000, 0x00020000, 0x00020000,
  0x00009100, 0x00000400, 0x00000400, 0x00089000, 0x00020000,
  0x00020000, 0x00020000, 0x00020000, 0x00020000, 0x00009100,
  0x00001000, 0x00089000, 0x00020000, 0x00020000, 0x00020000,
  0x00009100, 0x00000400, 0x00000400, 0x00089000, 0x00020000,
  0x00020000, 0x00020000, 0x00020000, 0x00020000, 0x00009100,
  0x00001000
};
static unsigned int times[ARRAYSIZE] = {
  312498, 406248, 499998, 593748, 687498,
  781248, 874998, 968748, 1062498, 1156248,
  1249998, 1343748, 1437498, 1812498, 1906248,
  1999998, 2093748, 2187498, 2281248, 2374998,
  2468748, 2562498, 2656248, 2749998, 2843748,
  2937498, 3312498, 3406248, 3499998, 3593748,
  3687498, 3781248, 3968748, 4062498, 4156248,
  4203123, 4249998, 4296873, 4343748, 4437498,
  4624998, 4812498, 4906248, 4999998, 5093748,
  5187498, 5281248, 5468748, 5562498, 5656248,
  5703123, 5749998, 5796873, 5843748, 5937498,
  6124998
};

int main(void) {
  NU32_Startup();

  int j;
  for (j = 0; j < ARRAYSIZE; j++) {
    notes[j] = notes[j] >> 8;
  }

  TRISBCLR = 0xFFFF;
  LATBCLR = 0xFFFF;

  __builtin_disable_interrupts();
  T2CONbits.T32 = 1;
  T2CONbits.TCKPS = 7;
  T2CONbits.ON = 1;
  __builtin_enable_interrupts();

  while (1) {
    if (TMR2 > times[i]) {
      LATBSET = notes[i];
      for (j = 0; j < 1000000; j++) {
        _nop();
      }
      LATBCLR = 0xFFFF;
      if (++i == ARRAYSIZE) {
        TMR2 = 0;
        i = 0;
      }
    }
  }
}
